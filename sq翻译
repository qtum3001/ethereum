什么是Sharding？这个以太坊尺度概念的指南解释

随着加密货币的扩展争论的继续，一些潜在的解决方案实际上已经开发了很长一段时间。具体而言，在以太坊中，以可扩展性为代价将重点放在分散化和安全性上，将分片与实施利益共识一致的应用视为网络可扩展到的急需机制。应用程序的实际水平，同时仍保持其权力下放和安全性。

分片是一个复杂的主题，特别是当应用于分散的对等网络（如以太坊）时，网络的全局状态不断更新。那么什么是分片呢？它如何帮助区块链网络扩展呢？

分片和分布式计算背景

分片实际上比区块链技术早得多，并且已在各种系统中实施，从业务数据库优化到Google的全球Spanner数据库。实质上，分片是一种在数据库中水平分区数据的特殊方法。更一般地说，数据库被分成称为“分片”的小块，当它们聚合在一起形成原始数据库时。

在分布式区块链网络中，网络由一系列以对等格式连接的节点组成，没有中央权限。与当前区块链系统的情况一样，每个节点存储网络的所有状态并处理所有事务。虽然这通过分散化提供了高级别的安全性，特别是在比特币和以太坊等工作证明系统中，但它会导致合法的扩展问题。

以以太坊为例，以太坊网络中的完整节点存储区块链的整个状态，包括账户余额，存储和合同代码。不幸的是，随着网络以指数速度增加，协商一致只会线性增加。这种限制是由于达成共识所需的节点之间所需的通信。

网络中的节点没有特殊权限，网络中的每个节点都存储和处理每个事务。因此，在以太网的大小网络中，当网络紧张时，诸如高燃气成本和更长的交易确认时间之类的问题成为显着的问题。网络的速度与单个节点的速度一样快，而不是其各部分的总和。

通过提供有趣但复杂的解决方案，分片有助于缓解这些问题。该概念涉及将节点子集分组为分片，然后分片处理特定于该分片的事务。它允许系统并行处理许多事务，从而显着提高吞吐量。

更简单的方法就是想象美国分裂为各州。虽然每个州（在这种情况下是一个碎片）是较大的美国（以太坊网络）的一部分，但它们有自己的特定规则，边界和人口子集。然而，他们确实共享一种通用的语言和文化，作为构成国家的大型网络的一部分。

甚至更好，用Vitalik Buterin自己的话来说：

 “想象一下，以太坊已被分裂成数千个岛屿。每个岛屿都可以做自己的事情。每个岛屿都有自己独特的特征，每个岛屿上的人，即帐户，都可以互相交流，他们可以自由地沉迷于其所有的功能。如果他们想要联系其他岛屿，他们将不得不使用某种协议。“

正如您所看到的，将网络分段为更高效的部分的概念允许网络作为其各部分的总和，而不是受每个单独节点的速度限制。

如何在区块链中进行分片？
我们将继续使用以太坊作为示例，因为它是区块链领域中最着名和最艰难的分片尝试，因为以太坊开发人员正在实施所谓的“状态分片”。

以太坊区块链的当前状态被称为“全局状态”，是每个人在查看特定实例的区块链时可以看到的。在以太坊实现分片的棘手部分是，通过将节点分割成更小的子集，这些子集需要能够处理特定的事务集，同时更新网络状态，同时确保它是有效的。

在以太坊中的分片应该在两阶段推出中实施，很可能在网络中实施了Stof of Stake之后。第一阶段将是数据层，其中包括碎片中数据的共识。第二阶段是状态层。所有这些都是非常流畅的，因此下面将介绍它的工作方式。

以太坊将网络分解为特定的分片。为每个分片分配一组特定的事务，这些事务是通过将特定帐户（包括智能合约）分组到分片中来确定的。每个事务组都有一个标题和一个由以下内容组成的正文。

头
事务组的分片ID
通过随机抽样分配验证器（验证分片中的事务）
State Root（添加事务之前和之后的分片的merkle根状态）

身体
属于特定分片的事务组的所有事务。

事务特定于每个分片，并发生在该分片的本机帐户之间。验证交易后，网络状态会发生变化，帐户余额，存储等也会更新。为了使事务组验证为有效，事务组的预状态根必须与全局状态中的分片根匹配。如果它们匹配，则验证事务组，并通过特定的分片ID状态根更新全局状态。

而不仅仅包含状态根，以太坊区块链的每个块现在都包含状态根和事务组根。事务组root是来自该事务块的特定分片的所有事务组的merkle根。基本上，所有不同分片都有一个merkle根，其中包含更新和验证的事务组。此根与更新的状态根一起存储在区块链中。

在这种结构中使用merkle树概念对于确保区块链的有效性至关重要。了解merkle树，特别是merkle root如何工作，可以帮助您更轻松地掌握这些概念。

通过随机选择的节点的共同证明达成共享，在特定共识轮次中应用于分片。这不仅为分享中的共识提供了终结性，而且还为在这种情况下工作证明区块链易受攻击的攻击提供了特定的防御。

在PoW分片网络中超出特定分片所需的散列功率大大降低，并且恶意行为者通过计算能力接管分片的能力是可行的。通过这种方式，坏人可以通过通信协议攻击其他分片，这是分片架构的一个更复杂和重要的特性。对碎片内的验证器进行随机抽样选择可以扼杀这种类型的攻击，因为坏的演员在实际放入它之前不会知道它们被放置在哪个碎片中。此外，随机采样将用于选择实际从该随机验证集验证的验证器。

通信协议对于分片架构在系统中正确运行至关重要。您可以将通信协议视为通用语言，这些通用语言在作为较大美国的一部分的州之间是一致的。但是，设计此协议非常具有挑战性，需要执行以便仅在必要时使用。当特定节点需要未存储在其自己的分片中的信息并且需要查找具有必需信息的分片时，这变得必要。这种通信称为交叉分片通信。

通过应用交易收据的概念来实现交叉分片通信。事务的收据存储在merkle根目录中，该根目录可以轻松验证但不属于状态根目录。从另一个分片接收事务的分片检查merkle root以确保没有花费收据。基本上，收据存储在共享内存中，可以由其他分片验证，但不能更改。因此，通过收据的分布式存储，分片能够彼此通信。

分解前进
预计将在Casper PoS升级后实施以太坊中的分片。最近，关于以太坊2.0的一些发展已涉及实施Casper和分片。 Casper似乎计划在2019年进行，而分类将在2020年或2021年进行。

Sharding也已在其他一些平台上实施，尤其是Zilliqa。但是，Zilliqa此时并未实现状态分片，而是专注于通过利用事务和计算分片来提供高吞吐量的区块链。

结论
Sharding用于为区块链平台中的大象提供一些有前途的解决方案，可扩展性。虽然比特币的闪电网络正处于测试阶段，并且到目前为止已经展示了一些非常有希望的进展，但以太坊的解决方案带来了一些独特的挑战，因为它被固定为图灵完整的世界计算机。

分片将仅在协议级别直接起作用，因此对于最终用户或dapp开发人员而言，它可能不一定与学习有关。无论如何，以太坊试图在一个庞大的，分散的网络中进行状态分割是一项令人印象深刻的努力，如果成功实施，将是一项巨大的成就。
